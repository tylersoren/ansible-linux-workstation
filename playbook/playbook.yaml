---

- name: Configure Workstation
  hosts: localhost
  vars:
    user: tyler
    user_windows_path: /c/Users/tyler.sorensen
  tasks:
    - name: Install base required packages
      apt:
        pkg:
        - zsh
        - curl
        - wget
        - bash-completion
        - git
        - software-properties-common
        - python3.8
        - python3-pip
        state: latest
  
    - name: Install Terraform
      unarchive:
        src: https://releases.hashicorp.com/terraform/0.12.25/terraform_0.12.25_linux_amd64.zip
        dest: /usr/local/bin
        remote_src: True
    
    - name: Install Vault
      unarchive:
        src: https://releases.hashicorp.com/vault/1.4.1/vault_1.4.1_linux_amd64.zip
        dest: /usr/local/bin
        remote_src: True
    
    - name: Create wsl.conf
      # Creates config file for WSL that sets drives to automount at root / instead of /mnt
      # https://itnext.io/setting-up-the-kubernetes-tooling-on-windows-10-wsl-d852ddc6699c
      copy:
        dest: "/etc/wsl.conf"
        content: |
          [automount]
          root = /
          options = "metadata"

    - name: pip self-update
      pip:
        name: pip
        state: latest
        executable: pip3

    - name: Install Python Packages
      pip:
        name:
          - pipenv
          - docker-compose
        executable: pip3

    - import_tasks: powershell.yaml
    - import_tasks: zsh.yaml
    - import_tasks: kube-tools.yaml
    - import_tasks: azure-cli.yaml
    
    - name: Remove useless packages from the cache
      apt:
        autoclean: yes

    - name: Remove dependencies that are no longer required
      apt:
        autoremove: yes